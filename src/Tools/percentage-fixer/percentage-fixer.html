<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="./percentage-fixer.css" />
        <script src="/Rain-Support-Tools/src/common/vue/vue.global.prod.js"></script>
        <script src="./percentage-fixer.js" type="module"></script>
        <script src="https://kit.fontawesome.com/8e52a98e38.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="menu-wrapper">
            <nav-menu></nav-menu>
            <script src="/Rain-Support-Tools/src/common/navigation/nav-builder.js" type="module"></script>
        </div>
        <div id="percentage-fixer">
            <growl-ctrl ref="growlCtrl"></growl-ctrl>
            <div id="title-wrapper">
                <h1>Percentage Fixer</h1>
            </div>
            <div class="content-wrapper">
                <div id="text-wrapper">
                    <div class="text-wrapper-item">
                        <h6>Current Values</h6>
                        <textarea v-model="inputValues" id="input-values" placeholder="Enter values here"></textarea>
                    </div>
                    <div class="text-wrapper-item">
                        <h6>Values Before Changes</h6>
                        <textarea v-model="outputValues" disabled id="output-values" placeholder="Output values will appear here" @click="copyOutputValues"></textarea>
                    </div>
                </div>
                <div id="action-wrapper">
                    <div id="action-buttons-wrapper">
                        <button @click="confirmActions" class="btn primary">Process Changes</button>
                        <button @click="clearData" class="btn secondary">Clear Data</button>
                        <button @click="copyOutputValues" class="btn primary">Copy New Values</button>
                    </div>
                    <div id="action-header">
                        <div class="action-header-spacer">
                            <span class="fa-solid fa-question-circle" @click="showHelp = true"></span>
                        </div>
                        <div class="action-header-item">Action</div>
                        <div class="action-header-item">Value</div>
                        <div class="action-header-item">Type</div>
                        <div class="action-header-spacer"></div>
                    </div>
                    <div id="action-list">
                        <div v-for="(action, index) in actions" :key="index" class="action-item">
                            <span class="action-item-index">{{ index + 1 }}</span>
                            <div class="toggle-wrapper">
                                <div class="toggle-wrapper-item">
                                    <label>Increase</label>
                                    <input type="checkbox" v-model="action.increase" value="Increase" @change="handleIncreaseChange(index)" />
                                </div>
                                <div class="toggle-wrapper-item">
                                    <label>Decrease</label>
                                    <input type="checkbox" v-model="action.decrease" value="Decrease" @change="handleDecreaseChange(index)" />
                                </div>
                            </div>
                            <input type="number" v-model="action.value" placeholder="Enter value" />
                            <div class="toggle-wrapper">
                                <div class="toggle-wrapper-item">
                                    <label>Percentage</label>
                                    <input type="checkbox" v-model="action.percentage" value="Percentage" @change="handlePercentageChange(index)" />
                                </div>
                                <div class="toggle-wrapper-item">
                                    <label>Dollar</label>
                                    <input type="checkbox" v-model="action.dollar" value="Dollar" @change="handleDollarChange(index)" />
                                </div>
                            </div>
                            <span class="action-item-remove fa-solid fa-trash" @click="removeAction(index)"></span>
                        </div>
                        <div class="add-action-wrapper">
                            <button @click="addAction" class="btn secondary add-action-button">+ Add Action</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="help-wrapper" v-if="showHelp">
                <span class="fa-solid fa-xmark" @click="showHelp = false"></span>
                <div id="help-header">
                    <h1>Help</h1>
                </div>
                <div id="help-content">
                    <div id="help-content-item">
                        <h2>What is this tool?</h2>
                        <p>This tool is designed to help fix bulk changes to a list of values. It will take the current values and use the changes from the right column to reverse determine what the value was before the changes happened.</p>
                        <h2>How to use</h2>
                        <p>1. Enter the current values in the "Current Values" textarea.</p>
                        <p>2. Add actions to the list to the right. These will be used to reverse the actions that happened, so it is important to add the actions in the order they happened. <br>(Example: If the value was increased by 10%, then decreased by 5%, then increased by 20%, then the actions should be added in the order of increase, decrease, increase)</p>
                        <p>3. Click the "Process Changes" button to apply the changes to the current values.</p>
                        <p>4. The new values will be displayed in the "Values Before Changes" textarea.<br>(Note: any none number values will be left as is, this will allow you to copy full columns from excel and not worry about issues of column header names.)</p>
                        <p>5. Click the "Copy New Values" button to copy the new values to the clipboard.</p>
                        <p>6. Click the "Clear Data" button to clear the data and start over.</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>