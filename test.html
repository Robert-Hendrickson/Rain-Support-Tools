<!DOCTYPE html>
<html>
    <head>
        <!--
        need to build handling for closing modal
        https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog
        -->
        <link rel="stylesheet" href="\Rain-Support-Tools\css\default.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <style>
            dialog{
                margin: 0 auto;
                top: 60px;
                width: 450px;
                min-height: 60px;
                padding: 16px;
                background-color: #dddddd;
                border: 3px solid #000;
                border-radius: 16px;
            }
            dialog::backdrop{
                background-color: #5c5c5c;
                opacity: 60%;
            }
            dialog #modal-content{
                padding-bottom: 10px;
            }
            dialog #buttons button{
                float: left;
            }
            dialog #buttons button:last-child{
                float: right;
            }
        </style>
    </head>
    <body>
        <div id="dialog-return"></div>
        <button onclick="customDialogResponse()">Show Dialog</button>
        <div id="respons-output"></div>
        <dialog></dialog>
        <script>
            let test_el = document.getElementsByTagName('dialog')[0];
            function getDialogResponse(text_string_content, submit_button = 'OK', close_button = "Close"){
                //resulting in 'promise is not defined' error when running.
                return new promise((resolve) => {
                    let dialog_el = $('dialog')[0];
                    
                    let html = '<div>{{content_text}}</div><div id="buttons"><button class="btn primary" id="submit-choice">{{submit_choice}}</button><button class="btn secondary" id="cancel-choice">{{cancel_choice}}</button></div>';
                    dialog_build = Vue.createApp({
                        template : html,
                        data() {
                            return {
                                'content_text': text_string_content,
                                'submit_choice': submit_button,
                                'cancel_choice': close_button
                            }
                        }
                    });
                    if(dialog_el.__vue_app__){
                        dialog_el.__vue_app__.unmount();
                    };
                    dialog_build.mount(dialog_el);

                    const handleYes = () => {
                        resolve(true);
                        dialog_el.close();
                    }

                    const handleNo = () => {
                        resolve(false);
                        dialog_el.close();
                    }

                    document.getElementById('submit-choice').addEventListener("click",handleYes,{once: true})
                    document.getElementById('submit-choice').addEventListener("click",handleNo,{once: true})
                    dialog_el.showModal();
                });
            }
            async function customDialogResponse(){
                const result = await getDialogResponse('test stuff');
                if(result){
                    console.log('success');
                }else{
                    console.log('failed');
                }
            }
        </script>
    </body>
</html>